<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick-Scan DRA - Madurez en Gestion de Datos | The Wise Monkey Project</title>
    <style>
        :root {
            --primary: #0066cc;
            --danger: #dc3545;
            --warning: #f0ad4e;
            --success: #28a745;
            --info: #17a2b8;
            --dark: #1e1e2e;
            --gray: #6c757d;
            --light: #f5f5fa;
            --white: #ffffff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #333; line-height: 1.6; background: var(--light);
        }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header {
            background: var(--dark); color: var(--white); padding: 20px 0; margin-bottom: 30px;
        }
        .header .container { display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.3rem; font-weight: 600; }
        .header .badge { background: var(--primary); padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; }
        .card {
            background: var(--white); border-radius: 8px; padding: 24px;
            margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .card h2 { font-size: 1.2rem; margin-bottom: 16px; color: var(--dark); }
        .form-group { margin-bottom: 18px; }
        .form-group > label {
            display: block; font-weight: 600; margin-bottom: 6px; font-size: 0.95rem;
        }
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group select {
            width: 100%; padding: 10px 12px; border: 1px solid #ddd;
            border-radius: 6px; font-size: 0.95rem;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary); outline: none;
            box-shadow: 0 0 0 2px rgba(0,102,204,0.15);
        }
        .radio-group {
            display: flex; flex-direction: column; gap: 6px; margin-top: 6px;
        }
        .radio-group label {
            font-weight: 400; display: flex; align-items: flex-start; gap: 8px;
            padding: 8px 12px; border: 1px solid #eee; border-radius: 6px;
            cursor: pointer; transition: background 0.15s;
        }
        .radio-group label:hover { background: var(--light); }
        .radio-group input[type="radio"] { margin-top: 3px; flex-shrink: 0; }
        .ka-section { border-left: 3px solid var(--primary); padding-left: 16px; margin-bottom: 24px; }
        .ka-section.ka-governance { border-color: #6f42c1; }
        .ka-section.ka-security { border-color: var(--danger); }
        .ka-section.ka-integration { border-color: var(--info); }
        .ka-section.ka-awareness { border-color: var(--warning); }
        .ka-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 4px; }
        .ka-subtitle { font-size: 0.8rem; color: var(--gray); margin-bottom: 12px; }
        .btn {
            display: inline-block; padding: 12px 28px; border: none; border-radius: 6px;
            font-size: 1rem; font-weight: 600; cursor: pointer; text-decoration: none;
            transition: opacity 0.15s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-block { display: block; width: 100%; text-align: center; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .framework-badges {
            display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;
        }
        .framework-badge {
            background: #e8eef6; color: var(--primary); padding: 2px 10px;
            border-radius: 10px; font-size: 0.75rem; font-weight: 600;
        }

        /* Results */
        .result-banner {
            text-align: center; padding: 30px; border-radius: 8px; margin-bottom: 20px;
        }
        .result-banner.critico { background: #fde8ea; border: 2px solid var(--danger); }
        .result-banner.bajo { background: #fff3e0; border: 2px solid var(--warning); }
        .result-banner.medio { background: #e8f5e9; border: 2px solid var(--success); }
        .result-banner.alto { background: #e3f2fd; border: 2px solid var(--info); }
        .result-banner h2 { font-size: 1.5rem; margin-bottom: 8px; }
        .score-big { font-size: 2.5rem; font-weight: 700; margin: 8px 0; }
        .progress-bar {
            height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin-top: 4px;
        }
        .progress-bar .fill { height: 100%; border-radius: 5px; transition: width 0.6s ease; }
        .ka-result { margin-bottom: 16px; }
        .ka-result-header { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 4px; }
        .hidden { display: none; }

        /* Print styles */
        @media print {
            body { background: white; }
            .header { margin-bottom: 10px; }
            .card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
            .no-print { display: none !important; }
            .result-banner { break-inside: avoid; }
        }
        @media (max-width: 600px) {
            .container { padding: 12px; }
            .card { padding: 16px; }
            .framework-badges { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>The Wise Monkey Project</h1>
            <span class="badge" id="headerBadge">Quick-Scan DRA</span>
        </div>
    </div>

    <!-- ==================== FORMULARIO ==================== -->
    <div class="container" id="formSection">
        <div class="card">
            <h2>Quick-Scan DRA: Madurez en Gestion de Datos</h2>
            <p>Evalua en 2-3 minutos el nivel de madurez de tu organizacion en gestion de datos y preparacion para la Ley 21.719.</p>
            <p style="color: var(--gray); font-size: 0.9rem; margin-top: 8px;">
                Basado en frameworks internacionales: DAMA-DMBOK2, NIST Privacy Framework y CMM/CMMI.
            </p>
            <div class="framework-badges">
                <span class="framework-badge">DAMA-DMBOK2</span>
                <span class="framework-badge">NIST Privacy Framework</span>
                <span class="framework-badge">CMM/CMMI</span>
            </div>
            <p style="color: var(--gray); font-size: 0.85rem; margin-top: 12px;">
                7 preguntas. Confidencial. No constituye auditoria legal.
            </p>
        </div>

        <form id="quickScanForm" onsubmit="return procesarQuickScan(event)">

            <!-- DATOS DE CONTACTO -->
            <div class="card">
                <h2>Datos de Contacto</h2>
                <div class="form-group">
                    <label for="nombre_contacto">Nombre completo *</label>
                    <input type="text" id="nombre_contacto" name="nombre_contacto" required minlength="2" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="email">Email corporativo *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="empresa">Empresa *</label>
                    <input type="text" id="empresa" name="empresa" required minlength="2" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="cargo">Cargo</label>
                    <input type="text" id="cargo" name="cargo" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="tamano">Tamano de la empresa *</label>
                    <select id="tamano" name="tamano" required>
                        <option value="">Seleccionar...</option>
                        <option value="micro_pyme">Micro/Pyme (1-49 empleados)</option>
                        <option value="mediana">Mediana (50-199 empleados)</option>
                        <option value="grande">Grande (200+ empleados)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sector">Sector *</label>
                    <select id="sector" name="sector" required>
                        <option value="">Seleccionar...</option>
                        <option value="fintech">Fintech / Financiero</option>
                        <option value="salud">Salud</option>
                        <option value="retail">Retail / Comercio</option>
                        <option value="educacion">Educacion</option>
                        <option value="servicios">Servicios</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
            </div>

            <!-- Q1: GOBERNANZA DE DATOS -->
            <div class="card">
                <div class="ka-section ka-governance">
                    <div class="ka-title">Q1. Gobernanza de Datos</div>
                    <div class="ka-subtitle">Knowledge Area: Data Governance (DMBOK2) | NIST: Govern-P</div>
                    <div class="form-group">
                        <label>Existe alguna politica formal o persona responsable de como se manejan los datos de clientes y empleados en la empresa? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q1" value="0" required> No, nadie se encarga de eso</label>
                            <label><input type="radio" name="q1" value="1"> Alguien de TI lo ve informalmente</label>
                            <label><input type="radio" name="q1" value="2"> Hay un responsable pero sin politica escrita</label>
                            <label><input type="radio" name="q1" value="3"> Hay politica escrita y un responsable formal</label>
                            <label><input type="radio" name="q1" value="4"> Politica aprobada por directorio, roles definidos, revisiones periodicas</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q2: SEGURIDAD - CONTROL DE ACCESO -->
            <div class="card">
                <div class="ka-section ka-security">
                    <div class="ka-title">Q2. Control de Acceso</div>
                    <div class="ka-subtitle">Knowledge Area: Data Security (DMBOK2) | NIST: Protect-P</div>
                    <div class="form-group">
                        <label>Como controlan quien puede acceder a los datos personales de clientes y empleados? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q2" value="0" required> Todos acceden a todo, contrasenas compartidas</label>
                            <label><input type="radio" name="q2" value="1"> Cada uno tiene contrasena propia pero todos ven todo</label>
                            <label><input type="radio" name="q2" value="2"> Hay algunos perfiles diferenciados</label>
                            <label><input type="radio" name="q2" value="3"> Acceso por roles, solo ven lo que necesitan</label>
                            <label><input type="radio" name="q2" value="4"> Roles + MFA + logs de acceso monitoreados</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q3: SEGURIDAD - PROTECCION TECNICA -->
            <div class="card">
                <div class="ka-section ka-security">
                    <div class="ka-title">Q3. Proteccion Tecnica</div>
                    <div class="ka-subtitle">Knowledge Area: Data Security (DMBOK2) | NIST: Protect-P</div>
                    <div class="form-group">
                        <label>Los datos sensibles estan encriptados? Tienen respaldo (backup)? Que pasa si se pierde un computador con datos de clientes? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q3" value="0" required> No hay encriptacion ni backup</label>
                            <label><input type="radio" name="q3" value="1"> Hay backup basico pero sin encriptacion</label>
                            <label><input type="radio" name="q3" value="2"> Backup regular, encriptacion parcial</label>
                            <label><input type="radio" name="q3" value="3"> Backup probado, encriptacion en reposo y transito</label>
                            <label><input type="radio" name="q3" value="4"> Todo encriptado, backup automatico probado, disco encriptado en laptops</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q4: INTEGRACION - FLUJO DE DATOS -->
            <div class="card">
                <div class="ka-section ka-integration">
                    <div class="ka-title">Q4. Flujo de Datos</div>
                    <div class="ka-subtitle">Knowledge Area: Data Integration & Interoperability (DMBOK2) | NIST: Identify-P / Control-P</div>
                    <div class="form-group">
                        <label>Saben como se mueven los datos dentro de la empresa y con quienes los comparten afuera (contadores, proveedores de email, hosting)? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q4" value="0" required> No hemos pensado en eso</label>
                            <label><input type="radio" name="q4" value="1"> Sabemos con quienes compartimos pero no esta documentado</label>
                            <label><input type="radio" name="q4" value="2"> Tenemos una lista parcial de proveedores</label>
                            <label><input type="radio" name="q4" value="3"> Flujos documentados, lista de terceros, contratos</label>
                            <label><input type="radio" name="q4" value="4"> Mapa completo de flujos, contratos DPA con todos los terceros</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q5: AWARENESS - PREPARACION LEY -->
            <div class="card">
                <div class="ka-section ka-awareness">
                    <div class="ka-title">Q5. Preparacion para la Ley 21.719</div>
                    <div class="ka-subtitle">Compliance & Awareness | Vigencia: diciembre 2026</div>
                    <div class="form-group">
                        <label>Que tan preparados estan para la Ley 21.719 que entra en vigencia en diciembre 2026? Han tomado alguna accion concreta? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q5" value="0" required> No conocemos la ley</label>
                            <label><input type="radio" name="q5" value="1"> Sabemos que existe pero no hemos hecho nada</label>
                            <label><input type="radio" name="q5" value="2"> Estamos averiguando, hemos consultado a un abogado</label>
                            <label><input type="radio" name="q5" value="3"> Tenemos plan de accion con hitos y responsables</label>
                            <label><input type="radio" name="q5" value="4"> Ya estamos implementando cambios, tenemos DPO y modelo de prevencion</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q6: AWARENESS - CAPACITACION -->
            <div class="card">
                <div class="ka-section ka-awareness">
                    <div class="ka-title">Q6. Capacitacion</div>
                    <div class="ka-subtitle">Compliance & Awareness | Capital humano</div>
                    <div class="form-group">
                        <label>El personal que maneja datos sabe que cuidados debe tener? Han recibido alguna capacitacion? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q6" value="0" required> No hay capacitacion</label>
                            <label><input type="radio" name="q6" value="1"> Se les dice informalmente que tengan cuidado</label>
                            <label><input type="radio" name="q6" value="2"> Hubo una charla alguna vez</label>
                            <label><input type="radio" name="q6" value="3"> Capacitacion anual para todo el personal relevante</label>
                            <label><input type="radio" name="q6" value="4"> Programa continuo, certificado, con evaluaciones</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q7: SEGURIDAD - RESPUESTA A INCIDENTES -->
            <div class="card">
                <div class="ka-section ka-security">
                    <div class="ka-title">Q7. Respuesta a Incidentes</div>
                    <div class="ka-subtitle">Knowledge Area: Data Security (DMBOK2) | NIST: Protect-P / Respond</div>
                    <div class="form-group">
                        <label>Si manana descubren que alguien accedio sin autorizacion a datos de clientes, que harian? Tienen un plan? *</label>
                        <div class="radio-group">
                            <label><input type="radio" name="q7" value="0" required> No hemos pensado en eso</label>
                            <label><input type="radio" name="q7" value="1"> Llamariamos a alguien de TI</label>
                            <label><input type="radio" name="q7" value="2"> Tenemos una idea general de que hacer</label>
                            <label><input type="radio" name="q7" value="3"> Plan escrito con roles, procedimientos y contactos</label>
                            <label><input type="radio" name="q7" value="4"> Plan probado con simulacros, notificacion automatica</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <button type="submit" class="btn btn-primary btn-block" id="submitBtn">Obtener mi Quick-Scan DRA</button>
                <p style="margin-top: 12px; font-size: 0.85rem; color: var(--gray);">
                    Resultados inmediatos en pantalla. Sin costo, sin compromiso.
                </p>
            </div>
        </form>
    </div>

    <!-- ==================== RESULTADOS ==================== -->
    <div class="container hidden" id="resultSection">
        <!-- Populated by JavaScript -->
    </div>

    <div style="text-align: center; padding: 20px; color: var(--gray); font-size: 0.8rem;">
        &copy; 2026 The Wise Monkey Project. Quick-Scan orientativo basado en DAMA-DMBOK2, NIST PF y CMM/CMMI. No constituye auditoria legal.
    </div>

    <script>
    // ============================================================
    // QUICK-SCAN DRA SCORING ENGINE
    // Replica de QuickScanScoring (DRA src/scoring.py)
    // 7 preguntas, escala 0-4, score 0-100%
    // ============================================================

    const QUESTIONS = ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7'];

    const QUESTION_LABELS = {
        q1: 'Gobernanza de Datos',
        q2: 'Control de Acceso',
        q3: 'Proteccion Tecnica',
        q4: 'Flujo de Datos',
        q5: 'Preparacion Ley 21.719',
        q6: 'Capacitacion',
        q7: 'Respuesta a Incidentes'
    };

    // Mapeo pregunta → Knowledge Area (DMBOK2)
    const KA_MAPPING = {
        q1: 'governance',
        q2: 'security',
        q3: 'security',
        q4: 'integration',
        q5: 'governance',
        q6: 'governance',
        q7: 'security'
    };

    const KA_NAMES = {
        governance: 'Data Governance',
        security: 'Data Security',
        integration: 'Data Integration & Interoperability'
    };

    const KA_COLORS = {
        governance: '#6f42c1',
        security: '#dc3545',
        integration: '#17a2b8'
    };

    const LEVELS = [
        { min: 0, max: 25, nivel: 'Critico', clase: 'critico', rec: 'DRA Assessment urgente — minimo 3 Knowledge Areas. Alto riesgo regulatorio ante la Ley 21.719.' },
        { min: 26, max: 50, nivel: 'Bajo', clase: 'bajo', rec: 'DRA Assessment recomendado — priorizar las Knowledge Areas con peor score para cerrar brechas criticas.' },
        { min: 51, max: 75, nivel: 'Medio', clase: 'medio', rec: 'DRA Assessment selectivo — foco en gaps especificos identificados en las areas mas debiles.' },
        { min: 76, max: 100, nivel: 'Alto', clase: 'alto', rec: 'Buen nivel de madurez. Recomendamos DRA lite o monitoreo periodico para mantener el cumplimiento.' }
    ];

    const CRITICAL_AREA_LABELS = {
        governance: 'Gobernanza de Datos — Sin estructura formal de gestion de datos ni roles definidos.',
        security: 'Seguridad de Datos — Controles insuficientes para proteger datos personales.',
        integration: 'Integracion de Datos — Flujos de datos no mapeados ni controlados con terceros.'
    };

    // ---- CONFIGURABLE: Link de WhatsApp ----
    const WHATSAPP_URL = "https://wa.me/56988044140?text=Hola%2C%20acabo%20de%20completar%20el%20Quick-Scan%20DRA%20y%20me%20gustar%C3%ADa%20saber%20m%C3%A1s%20sobre%20el%20DRA%20Assessment.";

    // ---- CONFIGURABLE: URL de tu Google Apps Script (web app) ----
    const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbz2RPJSvQA5HY0MLke7mUOFfsBccP5kEotsIqPbGXXAQy0G8UW13OvlBppAYpxsWLn4ZQ/exec";

    function getRadioValue(name) {
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? parseInt(el.value) : 0;
    }

    function calcularQuickScan() {
        const responses = {};
        for (const q of QUESTIONS) {
            responses[q] = getRadioValue(q);
        }

        const total = Object.values(responses).reduce((sum, v) => sum + v, 0);
        const maxScore = QUESTIONS.length * 4; // 28
        const percentage = Math.round((total / maxScore) * 100);

        // Determine level
        let nivel = 'Desconocido';
        let clase = 'bajo';
        let recommendation = '';
        for (const lv of LEVELS) {
            if (percentage >= lv.min && percentage <= lv.max) {
                nivel = lv.nivel;
                clase = lv.clase;
                recommendation = lv.rec;
                break;
            }
        }

        // Calculate KA averages
        const kaScores = {};
        const kaCounts = {};
        for (const q of QUESTIONS) {
            const ka = KA_MAPPING[q];
            kaScores[ka] = (kaScores[ka] || 0) + responses[q];
            kaCounts[ka] = (kaCounts[ka] || 0) + 1;
        }
        const kaAverages = {};
        for (const ka of Object.keys(kaScores)) {
            kaAverages[ka] = kaScores[ka] / kaCounts[ka];
        }

        // Identify critical area (lowest KA average)
        let criticalKA = Object.keys(kaAverages).reduce((a, b) => kaAverages[a] <= kaAverages[b] ? a : b);

        // Sort KAs by score (ascending = most needy first)
        const suggestedKAs = Object.keys(kaAverages).sort((a, b) => kaAverages[a] - kaAverages[b]);

        // Per-question details for gap analysis
        const questionDetails = QUESTIONS.map(q => ({
            key: q,
            label: QUESTION_LABELS[q],
            ka: KA_MAPPING[q],
            score: responses[q],
            maxScore: 4
        }));

        // Financial exposure based on level
        let exposure;
        if (nivel === 'Critico') {
            exposure = 'USD $350,000 - $1,400,000 (multas graves a gravisimas)';
        } else if (nivel === 'Bajo') {
            exposure = 'USD $50,000 - $700,000 (multas leves a graves)';
        } else if (nivel === 'Medio') {
            exposure = 'Exposicion moderada — brechas especificas pueden generar multas leves';
        } else {
            exposure = 'Riesgo financiero bajo con controles actuales';
        }

        return {
            responses,
            total,
            maxScore,
            percentage,
            nivel,
            clase,
            recommendation,
            kaAverages,
            criticalKA,
            suggestedKAs,
            questionDetails,
            exposure
        };
    }

    function barColor(score, max) {
        const pct = (score / max) * 100;
        if (pct <= 25) return 'var(--danger)';
        if (pct <= 50) return 'var(--warning)';
        if (pct <= 75) return 'var(--success)';
        return 'var(--info)';
    }

    function renderResultados(result, contacto) {
        let html = '';

        // Banner with score
        html += `
            <div class="result-banner ${result.clase}">
                <p style="font-size:0.9rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:4px;">Nivel de Madurez</p>
                <h2>${result.nivel}</h2>
                <div class="score-big">${result.percentage}%</div>
                <p>${result.total}/${result.maxScore} puntos</p>
                <p style="font-size:0.85rem; margin-top:8px; color:var(--gray);">${contacto.empresa} | ${contacto.nombre}</p>
            </div>`;

        // KA scores
        html += `<div class="card"><h2>Score por Knowledge Area (DMBOK2)</h2>`;
        for (const ka of ['governance', 'security', 'integration']) {
            const avg = result.kaAverages[ka] || 0;
            const pct = Math.round((avg / 4) * 100);
            const isCritical = ka === result.criticalKA;
            html += `
                <div class="ka-result" ${isCritical ? 'style="background:#fff5f5; padding:10px; border-radius:6px; margin:0 -10px 16px -10px;"' : ''}>
                    <div class="ka-result-header">
                        <strong style="color:${KA_COLORS[ka]}">${KA_NAMES[ka]}${isCritical ? ' (Area Critica)' : ''}</strong>
                        <span>${pct}% (${avg.toFixed(1)}/4.0)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="fill" style="width:${pct}%; background:${KA_COLORS[ka]};"></div>
                    </div>
                </div>`;
        }
        html += `</div>`;

        // Detail per question
        html += `<div class="card"><h2>Detalle por Pregunta</h2>`;
        for (const q of result.questionDetails) {
            const pct = Math.round((q.score / q.maxScore) * 100);
            html += `
                <div style="margin-bottom:12px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem;">
                        <span>${q.label}</span>
                        <span style="color:var(--gray); font-weight:600;">${q.score}/${q.maxScore}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="fill" style="width:${pct}%; background:${barColor(q.score, q.maxScore)};"></div>
                    </div>
                </div>`;
        }
        html += `</div>`;

        // Critical area
        html += `
            <div class="card" style="border-left: 4px solid var(--danger);">
                <h2 style="color: var(--danger);">Area Critica Identificada</h2>
                <p style="font-weight:600; margin-bottom:8px;">${KA_NAMES[result.criticalKA]}</p>
                <p>${CRITICAL_AREA_LABELS[result.criticalKA]}</p>
            </div>`;

        // Financial exposure
        html += `
            <div class="card">
                <h2>Exposicion Financiera Estimada (Ley 21.719)</h2>
                <p style="font-size:1.1rem; font-weight:600;">${result.exposure}</p>
                <p style="font-size:0.85rem; color:var(--gray); margin-top:8px;">
                    Basado en regimen sancionatorio: leves hasta ~$350K USD, graves ~$700K USD, gravisimas ~$1.4M USD. Reincidencia: 2-4% ingresos anuales.
                </p>
            </div>`;

        // Recommendation
        html += `
            <div class="card">
                <h2>Recomendacion</h2>
                <p>${result.recommendation}</p>
                <p style="margin-top:12px; font-size:0.9rem;">
                    <strong>Knowledge Areas sugeridas para DRA Assessment:</strong>
                    ${result.suggestedKAs.map(ka => KA_NAMES[ka]).join(' → ')}
                </p>
            </div>`;

        // Frameworks used
        html += `
            <div class="card">
                <h2>Metodologia Aplicada</h2>
                <p style="font-size:0.9rem;">Este Quick-Scan evalua 3 Knowledge Areas criticas usando triple framework:</p>
                <ul style="margin-top:8px; padding-left:20px; font-size:0.9rem;">
                    <li><strong>DAMA-DMBOK2</strong> — QUE evaluar (Knowledge Areas de gestion de datos)</li>
                    <li><strong>NIST Privacy Framework</strong> — CONTRA QUE comparar (Current vs Target Profile)</li>
                    <li><strong>CMM/CMMI</strong> — COMO medir (niveles 0-4 de madurez simplificados)</li>
                </ul>
                <p style="font-size:0.85rem; color:var(--gray); margin-top:8px;">
                    El DRA Assessment completo profundiza en 5 subdimensiones por KA (roles, procesos, herramientas, calidad, riesgos) con escala CMM 0-5.
                </p>
            </div>`;

        // CTA
        html += `
            <div class="card" style="text-align:center; background:var(--dark); color:var(--white);">
                <h2 style="color:var(--white);">Siguiente Paso: DRA Assessment</h2>
                <p style="margin-bottom:16px;">
                    Obtiene un diagnostico completo con gap analysis detallado, roadmap priorizado y quick wins implementables en semanas.
                </p>
                <a href="${WHATSAPP_URL}" class="btn btn-primary" target="_blank" style="background:#25D366; margin-bottom:12px;">
                    Solicitar DRA Assessment por WhatsApp
                </a>
                <p style="font-size:0.85rem; color:rgba(255,255,255,0.7); margin-top:12px;">
                    Conversacion de 15 min sin compromiso para entender tu situacion.
                </p>
            </div>`;

        // Print button
        html += `
            <div class="card no-print" style="text-align:center;">
                <button class="btn btn-primary" onclick="window.print()">Guardar como PDF</button>
                <p style="margin-top:8px; font-size:0.85rem; color:var(--gray);">
                    Usa "Guardar como PDF" en el dialogo de impresion para obtener tu reporte.
                </p>
            </div>`;

        document.getElementById('resultSection').innerHTML = html;
    }

    async function enviarAGoogleSheet(contacto, result) {
        if (!GOOGLE_SHEET_URL) return;
        try {
            const payload = {
                timestamp: new Date().toISOString(),
                nombre: contacto.nombre,
                email: contacto.email,
                empresa: contacto.empresa,
                cargo: contacto.cargo,
                tamano: contacto.tamano,
                sector: contacto.sector,
                q1: result.responses.q1,
                q2: result.responses.q2,
                q3: result.responses.q3,
                q4: result.responses.q4,
                q5: result.responses.q5,
                q6: result.responses.q6,
                q7: result.responses.q7,
                score_pct: result.percentage,
                nivel: result.nivel,
                area_critica: result.criticalKA,
                kas_sugeridas: result.suggestedKAs.join(' > '),
                ka_governance_pct: Math.round((result.kaAverages.governance / 4) * 100),
                ka_security_pct: Math.round((result.kaAverages.security / 4) * 100),
                ka_integration_pct: Math.round((result.kaAverages.integration / 4) * 100)
            };
            await fetch(GOOGLE_SHEET_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
        } catch (e) {
            console.warn("No se pudo enviar a Google Sheets:", e);
        }
    }

    function procesarQuickScan(event) {
        event.preventDefault();

        const contacto = {
            nombre: document.getElementById('nombre_contacto').value,
            email: document.getElementById('email').value,
            empresa: document.getElementById('empresa').value,
            cargo: document.getElementById('cargo').value || '',
            tamano: document.getElementById('tamano').value,
            sector: document.getElementById('sector').value
        };

        const result = calcularQuickScan();

        renderResultados(result, contacto);

        document.getElementById('formSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');
        document.getElementById('headerBadge').textContent = 'Resultados';
        window.scrollTo({ top: 0, behavior: 'smooth' });

        enviarAGoogleSheet(contacto, result);

        return false;
    }
    </script>
</body>
</html>
